<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Dashboard Valoración - SITEA</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    </h:head>

    <h:body>
        <ui:composition template="./../../TemplateSitio.xhtml">
            <ui:define name="content">
                
                <h:form id="formDashboard">
                    <p:growl id="msgs" showDetail="true" life="3000"/>

                    <div class="container mt-4">

                        <div class="card shadow-sm mb-4 border-top border-4 border-primary">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-1 text-center">
                                        <div class="bg-light rounded-circle p-3 d-inline-block">
                                            <i class="fas fa-user-graduate fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <h4 class="mb-1 text-primary fw-bold">
                                            #{caracterizacionControllerMejorado.caracterizacion.estudianteIdEstudiante.primerNombreEstudiante} 
                                            #{caracterizacionControllerMejorado.caracterizacion.estudianteIdEstudiante.primerApellidoEstudiante}
                                        </h4>
                                        <div class="text-muted small">
                                            <span class="me-3"><i class="fas fa-id-card me-1"></i> #{caracterizacionControllerMejorado.caracterizacion.estudianteIdEstudiante.numeroDocumentoEstudiante}</span>
                                            <span class="me-3"><i class="fas fa-folder-open me-1"></i> Exp: #{caracterizacionControllerMejorado.caracterizacion.expedienteCaracterizacion}</span>
                                            <span><i class="fas fa-graduation-cap me-1"></i> Grado: #{caracterizacionControllerMejorado.caracterizacion.estudianteIdEstudiante.cursoIdCurso.codigoCurso}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <h6 class="text-uppercase text-muted small fw-bold">Avance General</h6>
                                        <div class="progress" style="height: 20px;">
                                            <div class="#{'progress-bar ' + (caracterizacionControllerMejorado.porcentajeGeneral == 100 ? 'bg-success' : 'bg-warning')}"
                                                 role="progressbar" style="width: #{caracterizacionControllerMejorado.porcentajeGeneral}%;"
                                                 aria-valuenow="#{caracterizacionControllerMejorado.porcentajeGeneral}" aria-valuemin="0" aria-valuemax="100">
                                                #{caracterizacionControllerMejorado.porcentajeGeneral}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow-sm">
                            <div class="card-header bg-white py-3">
                                <h5 class="mb-0 text-dark"><i class="fas fa-list-ul me-2"></i>Dimensiones de Valoración</h5>
                            </div>
                            <div class="card-body p-0">
                                <p:dataTable value="#{caracterizacionControllerMejorado.dimensionesActuales}" var="dim"
                                             styleClass="table-hover" rowKey="#{dim.idDimension}"
                                             emptyMessage="No se han inicializado las dimensiones.">

                                    <p:column headerText="Dimensión" width="35%">
                                        <h:outputText value="#{dim.nombreDimension}" styleClass="fw-bold text-dark"/>
                                        <br/>
                                        <small class="text-muted">#{dim.descripcion}</small>
                                    </p:column>

                                    <p:column headerText="Estado" width="15%" styleClass="text-center">
                                        <h:panelGroup rendered="#{dim.estado == 'COMPLETADA'}">
                                            <span class="badge bg-success rounded-pill"><i class="fas fa-check me-1"></i>Completada</span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{dim.estado == 'EN_PROCESO'}">
                                            <span class="badge bg-warning text-dark rounded-pill"><i class="fas fa-pencil-alt me-1"></i>En Proceso</span>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{dim.estado == 'PENDIENTE' or dim.estado == null}">
                                            <span class="badge bg-secondary rounded-pill"><i class="far fa-circle me-1"></i>Pendiente</span>
                                        </h:panelGroup>
                                    </p:column>

                                    <p:column headerText="Última Act." width="20%" styleClass="text-center">
                                        <h:outputText value="#{dim.updatedAt}">
                                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                        </h:outputText>
                                        <h:outputText value="-" rendered="#{dim.updatedAt == null}"/>
                                    </p:column>

                                    <p:column headerText="Acción" width="15%" styleClass="text-center">
                                        <h:commandButton value="#{dim.estado == 'COMPLETADA' ? 'Editar' : 'Valorar'}"
                                                         action="#{caracterizacionControllerMejorado.navegarAFormularioDimension(dim)}"
                                                         styleClass="btn btn-sm #{dim.estado == 'COMPLETADA' ? 'btn-outline-primary' : 'btn-primary'} w-100">
                                        </h:commandButton>
                                    </p:column>

                                </p:dataTable>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4 mb-5">
                            <h:button value="← Volver al Listado" outcome="dashboardInicioCaracterizacion" 
                                      styleClass="btn btn-secondary"/>

                            <h:panelGroup rendered="#{caracterizacionControllerMejorado.porcentajeGeneral == 100}">
                                <h:commandButton value="Generar Informe Final →" 
                                                 action="#{caracterizacionControllerMejorado.generarInformeValoracion}"
                                                 styleClass="btn btn-success fw-bold px-4 shadow"/>
                            </h:panelGroup>
                            
                            <h:panelGroup rendered="#{caracterizacionControllerMejorado.porcentajeGeneral lt 100}">
                                <button class="btn btn-light text-muted border" disabled="disabled">
                                    Complete todas las dimensiones para generar informe
                                </button>
                            </h:panelGroup>
                        </div>

                    </div>
                </h:form>

            </ui:define>
        </ui:composition>
    </h:body>
</html>