<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html">


    <body>

        <ui:composition template="./../TemplateSitio.xhtml">

            <ui:define name="head">
         <title>Caracterización Pedagógica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        .container { max-width: 1400px; margin: auto; padding: 20px; }
        
        .header { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }
        .header h2 { margin: 0; font-size: 28px; }
        .header small { display: block; opacity: 0.9; margin-top: 5px; }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 15px; 
            margin-bottom: 30px;
        }
        
        .stat-card { 
            background: white; 
            border: 1px solid #e0e0e0;
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        .stat-card h3 { font-size: 14px; color: #666; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 32px; font-weight: bold; color: #333; }
        .stat-card progress { width: 100%; margin-top: 10px; height: 6px; }
        .stat-card .label { font-size: 12px; color: #999; margin-top: 8px; }
        
        /* Tabs */
        .tab-menu { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab-menu button { 
            padding: 12px 20px; 
            border: none; 
            background: transparent;
            border-bottom: 3px solid transparent;
            cursor: pointer; 
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }
        .tab-menu button:hover { color: #333; }
        .tab-menu button.active { 
            color: #667eea; 
            border-bottom-color: #667eea;
        }
        
        .tab-content { margin-top: 20px; }
        .tab { display: none; }
        
        /* Grid de dimensiones */
        .dimensions-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px;
        }
        
        /* Tarjeta de dimensión */
        .dimension-card { 
            background: white; 
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .dimension-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .dimension-header { 
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
        }
        .dimension-header .color-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            background: rgba(255,255,255,0.3);
        }
        .dimension-header h3 { 
            margin: 0; 
            font-size: 16px;
            font-weight: 600;
        }
        .dimension-header .status-badge { 
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 11px;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .dimension-body { 
            padding: 16px;
        }
        
        .progress-section { 
            margin-bottom: 16px;
        }
        .progress-label { 
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        .progress-bar { 
            width: 100%; 
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill { 
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .items-list { 
            margin: 12px 0;
            font-size: 13px;
        }
        .items-list .list-item { 
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
            color: #555;
        }
        .items-list .list-item .icon { 
            font-weight: bold;
            margin-top: 1px;
            width: 16px;
        }
        .items-list.strengths .list-item .icon { color: #4caf50; }
        .items-list.needs .list-item .icon { color: #ff9800; }
        .items-list.barriers .list-item .icon { color: #f44336; }
        
        .section-title { 
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
            margin-top: 12px;
            margin-bottom: 6px;
        }
        .section-title.strengths { color: #4caf50; }
        .section-title.needs { color: #ff9800; }
        .section-title.barriers { color: #f44336; }
        
        .action-button { 
            width: 100%;
            padding: 10px;
            margin-top: 14px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .action-button:hover { 
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .empty-state { 
            text-align: center; 
            padding: 40px;
            color: #999;
        }
    </style>

    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(el => el.style.display = 'none');
            document.getElementById(tab).style.display = 'block';

            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('btn-' + tab).classList.add('active');
        }
        window.onload = function(){ showTab('dimensiones'); };
    </script>
    </ui:define>
    <ui:define name="content" >
      
       

<h:form id="formCharacterization">
<div class="container">

    <!-- HEADER -->
    <div class="header">
        <h:commandButton value="⟵ Volver" action="#{characterizationBean.goBack}" style="padding:6px 14px;" />
        
        <div style="flex:1">
            <h2 style="margin:0;">Caracterización Pedagógica</h2>
            <h:outputText 
                value="#{characterizationBean.student.fullName} - Exp: #{characterizationBean.student.expediente}"
                style="color:gray;" />
        </div>
    </div>

    <!-- CARDS SUPERIORES -->
    <div class="grid">

        <div class="card">
            <h3>Progreso General</h3>
            <h:outputText value="#{characterizationBean.overallProgress}%" 
                          style="font-size:26px; font-weight:bold;" />
            <progress value="#{characterizationBean.overallProgress}" max="100" style="width:100%;"></progress>
        </div>

        <div class="card">
            <h3>Dimensiones Completadas</h3>
            <h:outputText value="#{characterizationBean.completedCount} / #{characterizationBean.dimensions.size()}" 
                          style="font-size:22px; font-weight:bold;" />
            <div style="background:#eee; padding:4px; border-radius:6px;">
                <h:outputText value="#{characterizationBean.percentageComplete} % Completo" />
            </div>
        </div>

        <div class="card">
            <h3>Fecha Estimada</h3>
            <h:outputText value="#{characterizationBean.estimatedEndDateDisplay}" style="font-weight:bold;" />
            <hr/>
            <h:outputText value="Iniciado: #{characterizationBean.startDateDisplay}" style="color:gray;" />
        </div>

    </div>

    <!-- TABS NATIVOS -->
    <div class="tab-menu" style="margin-top:25px;">
        <button id="btn-dimensiones" class="tab-btn" onclick="showTab('dimensiones')" type="button">Dimensiones</button>
        <button id="btn-linea" class="tab-btn" onclick="showTab('linea')" type="button">Línea de Tiempo</button>
        <button id="btn-acciones" class="tab-btn" onclick="showTab('acciones')" type="button">Acciones</button>
    </div>

    <div class="tab-content">

        <!-- TAB 1: DIMENSIONES -->
        <div id="dimensiones" class="tab">
            <div class="dimensions-grid">

                <ui:repeat value="#{characterizationBean.dimensions}" var="dim">

                    <div class="dimension-card">
                        <!-- ENCABEZADO -->
                        <div class="dimension-header">
                            <div class="color-dot"></div>
                            <h3>#{dim.name}</h3>
                            <div class="status-badge">#{characterizationBean.getStatusForDimension(dim.id)}</div>
                        </div>

                        <!-- CUERPO -->
                        <div class="dimension-body">
                            <!-- PROGRESO -->
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>Progreso</span>
                                    <strong>#{characterizationBean.getProgressForDimension(dim.id)}%</strong>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: #{characterizationBean.getProgressForDimension(dim.id)}%;"></div>
                                </div>
                            </div>

                            <!-- FORTALEZAS -->
                            <div class="section-title strengths">✓ Fortalezas: #{characterizationBean.getStrengthsForDimension(dim.id).size()}</div>
                            <div class="items-list strengths">
                                <ui:repeat value="#{characterizationBean.getStrengthsForDimension(dim.id)}" var="strength">
                                    <div class="list-item">
                                        <span class="icon">•</span>
                                        <span>#{strength}</span>
                                    </div>
                                </ui:repeat>
                            </div>

                            <!-- NECESIDADES -->
                            <div class="section-title needs">⚠ Necesidades: #{characterizationBean.getNeedsForDimension(dim.id).size()}</div>
                            <div class="items-list needs">
                                <ui:repeat value="#{characterizationBean.getNeedsForDimension(dim.id)}" var="need">
                                    <div class="list-item">
                                        <span class="icon">•</span>
                                        <span>#{need}</span>
                                    </div>
                                </ui:repeat>
                            </div>

                            <!-- BARRERAS -->
                            <div class="section-title barriers">✕ Barreras: #{characterizationBean.getBarriersForDimension(dim.id).size()}</div>
                            <div class="items-list barriers">
                                <ui:repeat value="#{characterizationBean.getBarriersForDimension(dim.id)}" var="barrier">
                                    <div class="list-item">
                                        <span class="icon">•</span>
                                        <span>#{barrier}</span>
                                    </div>
                                </ui:repeat>
                            </div>

                            <!-- BOTÓN DE ACCIÓN -->
                            <h:panelGroup rendered="#{characterizationBean.getProgressForDimension(dim.id) eq 0}">
                                <h:commandButton 
                                    value="Iniciar Valoración"
                                    action="#{characterizationBean.openDimension(dim.id)}"
                                    styleClass="action-button" />
                            </h:panelGroup>

                            <h:panelGroup rendered="#{characterizationBean.getProgressForDimension(dim.id) gt 0 and characterizationBean.getProgressForDimension(dim.id) lt 100}">
                                <h:commandButton 
                                    value="Continuar Valoración"
                                    action="#{characterizationBean.openDimension(dim.id)}"
                                    styleClass="action-button" />
                            </h:panelGroup>

                            <h:panelGroup rendered="#{characterizationBean.getProgressForDimension(dim.id) eq 100}">
                                <h:commandButton 
                                    value="Ver Valoración"
                                    action="#{characterizationBean.openDimension(dim.id)}"
                                    styleClass="action-button" 
                                    disabled="true"
                                    style="opacity: 0.7; cursor: not-allowed;" />
                            </h:panelGroup>
                        </div>
                    </div>

                </ui:repeat>

            </div>
        </div>

        <!-- TAB 2: LINEA DE TIEMPO -->
        <div id="linea" class="tab" style="display:none;">
            
            <h3>Historial del Proceso</h3>

            <h:panelGroup rendered="#{not empty characterizationBean.familyMeetingDate}">
                <div class="timeline-item">
                    <h4>Reunión Inicial con Familia</h4>
                    <small style="color:gray;">#{characterizationBean.familyMeetingDateDisplay}</small>
                    <p>#{characterizationBean.familyMeetingNotes}</p>
                </div>
            </h:panelGroup>

            <ui:repeat value="#{characterizationBean.assessments}" var="ass">
                <div class="timeline-item">
                    <h4>#{characterizationBean.getDimensionName(ass.dimensionId)}</h4>
                    <small style="color:gray;">#{ass.completedAtDisplay}</small>
                    <p>#{ass.observations}</p>
                </div>
            </ui:repeat>

        </div>

        <!-- TAB 3: ACCIONES -->
        <div id="acciones" class="tab" style="display:none;">
            <div class="grid">

                <div class="card">
                    <h3>Generar Informe</h3>
                    <p>Crear reporte consolidado de la valoración.</p>

                    <h:commandButton 
                        value="Generar Informe"
                        action="#{characterizationBean.generateReport}"
                        rendered="#{characterizationBean.overallProgress eq 100}"
                        style="padding:8px 12px; width:100%;" />

                    <h:panelGroup rendered="#{characterizationBean.overallProgress lt 100}">
                        <p style="color:gray; font-size:0.9em;">Debe completar todas las dimensiones</p>
                    </h:panelGroup>
                </div>

                <div class="card">
                    <h3>Transición a PIAR</h3>
                    <p>Iniciar el proceso de PIAR.</p>

                    <h:commandButton 
                        value="Ir a PIAR"
                        action="#{characterizationBean.goToPiar}"
                        rendered="#{characterizationBean.overallProgress ge 95}"
                        style="padding:8px 12px; width:100%;" />

                    <h:panelGroup rendered="#{characterizationBean.overallProgress lt 95}">
                        <p style="color:gray; font-size:0.9em;">Debe completar al menos el 95%.</p>
                    </h:panelGroup>
                </div>
            </div>
        </div>

    </div>

</div>
</h:form>
        
        
        
    </ui:define>


        </ui:composition>

    </body>
</html>
